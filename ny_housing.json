{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "New York Housing",
  "width": "container",
  "height": 560,
  "autosize": { "type": "fit", "contains": "padding" },
  "params": [
    {
      "name": "selectedType",
      "value": null
    }
  ],
  "projection": {
  "type": "mercator",
  "center": [-73.94, 40.70],   
  "scale": 50000               
},
  "layer": [
    {
      "data": {
        "url": "data/ne_10m_ocean.json",
        "format": { "type": "topojson", "feature": "ne_10m_ocean" }
      },
      "mark": { "type": "geoshape", "fill": "#79c6f0", "stroke": null }
    },
    {
      "data": {
        "url": "data/ne_10m_admin_2_counties.json",
        "format": { "type": "topojson", "feature": "ne_10m_admin_2_counties" }
      },
      "transform": [
        { "filter": "datum.properties.REGION_COD == '34'" }
      ],
      "mark": { "type": "geoshape", "fill": "#e0e0e0", "stroke": null }
    },
    {
      "data": {
        "values": [
          { "longitude": -74.2, "latitude": 40.80 }
        ]
      },
      "mark": {
        "type": "text",
        "text": "New Jersey",
        "color": "#555555",
        "fontSize": 16,
        "fontWeight": "bold"
      },
      "encoding": {
        "longitude": { "field": "longitude", "type": "quantitative" },
        "latitude": { "field": "latitude", "type": "quantitative" }
      }
    },
    {
      "data": {
        "url": "data/ne_10m_roads.json",
        "format": { "type": "topojson", "feature": "ne_10m_roads" }
      },
      "mark": {
        "type": "geoshape",
        "stroke": "#cc6600",
        "strokeWidth": 1.5,
        "fill": null
      }
    },
    {
      "data": { "url": "data/NY-House-Dataset.csv", "format": { "type": "csv" } },
      "transform": [
        { "calculate": "toNumber(replace(datum.PRICE, ',', ''))", "as": "price_num" },
        { "calculate": "format(datum.price_num, '$,.0f')", "as": "price_formatted" },
        { "calculate": "isNaN(toNumber(datum.BEDS)) ? null : round(toNumber(datum.BEDS))", "as": "beds_num" },
        { "calculate": "isNaN(toNumber(datum.BATH)) ? null : round(toNumber(datum.BATH))", "as": "bath_num" },
        { "calculate": "isNaN(toNumber(datum.PROPERTYSQFT)) ? null : round(toNumber(datum.PROPERTYSQFT))", "as": "sqft_num" },
        { "filter": "isValid(datum.LATITUDE) && isValid(datum.LONGITUDE)" },
        { "filter": "isValid(datum.price_num)" },
        { "filter": "selectedType && datum.TYPE == selectedType" }
      ],
      "mark": { "type": "circle", "opacity": 0.85 },
      "encoding": {
        "longitude": { "field": "LONGITUDE", "type": "quantitative" },
        "latitude":  { "field": "LATITUDE",  "type": "quantitative" },
        "size": {
          "field": "price_num",
          "type": "quantitative",
          "title": "Price (USD)",
          "scale": {
            "type": "sqrt",
            "domain": [500000, 100000000],
            "range": [20, 220],
            "clamp": true,
            "zero": false
          },
          "legend": {
            "orient": "right",
            "direction": "vertical",
            "titleAnchor": "start",
            "padding": 8,
            "values": [
              500000,
              1000000,
              2000000,
              5000000,
              10000000,
              20000000,
              50000000,
              100000000
            ]
          }
        },
        "color": {
          "field": "TYPE",
          "type": "nominal",
          "scale": {
            "domain": [
              "Co-op for sale",
              "Coming Soon",
              "Condo for sale",
              "Condop for sale",
              "Contingent",
              "For sale",
              "Foreclosure",
              "House for sale",
              "Land for sale",
              "Mobile house for sale",
              "Multi-family home for sale",
              "Pending",
              "Townhouse for sale"
            ],
            "range": [
              "#4e79a7",
              "#f28e2b",
              "#e15759",
              "#76b7b2",
              "#59a14f",
              "#edc948",
              "#b07aa1",
              "#ff9da7",
              "#9c755f",
              "#bab0ab",
              "#8cd17d",
              "#499894",
              "#d37295"
            ]
          },
          "legend": null
        },
        "tooltip": [
          { "field": "price_formatted", "type": "nominal", "title": "Price" },
          { "field": "TYPE", "type": "nominal", "title": "Type of House" },
          { "field": "beds_num", "type": "quantitative", "title": "Beds" },
          { "field": "bath_num", "type": "quantitative", "title": "Baths" },
          { "field": "SUBLOCALITY", "type": "nominal", "title": "Sublocality" },
          { "field": "FORMATTED_ADDRESS", "type": "nominal", "title": "Address" },
          { "field": "sqft_num", "type": "quantitative", "title": "Area (sqft)" }
        ]
      }
    }
  ]
}
